{% extends "tools/wwn/cheatsheets/cheatsheet_base.html" %}

{% block title %}Wilderness Exploration - Gnosis{% endblock %}

{% block cheatsheet_styles %}
<style>
    .compact-table {
        width: 100%;
        font-size: 0.85rem;
        margin: 0.5rem 0;
    }
    .compact-table th {
        font-weight: 600;
        color: var(--bs-secondary-color);
        font-size: 0.75rem;
        text-transform: uppercase;
    }
    .compact-table td:first-child {
        font-weight: bold;
        color: var(--bs-primary);
        width: 3rem;
        text-align: center;
    }
    .compact-table td:last-child {
        color: var(--bs-secondary-color);
    }

    .formula-box {
        font-family: monospace;
        font-size: 1rem;
        text-align: center;
        padding: 0.75rem;
    }
</style>
{% endblock %}

{% block cheatsheet_content %}
<div class="container">
    <div class="text-center mb-4">
        <h1 class="h2">Wilderness Exploration</h1>
    </div>

    <div class="row g-3">

        <!-- Overland Travel -->
        <div class="col-12 col-lg-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">Overland Travel</h5>
                </div>
                <div class="card-body">
                    <div class="action-item">
                        <h5>Travel Pace</h5>
                        <p>PCs travel <strong>10 hours per day</strong>. Horses don't increase average travel rate.</p>
                    </div>

                    <div class="action-item">
                        <h5>Terrain Speed</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Terrain</th><th>mph</th><th>mi/day</th></tr>
                            </thead>
                            <tbody>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Plains, savannas</td><td>3</td><td>30</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Light forest, desert</td><td>2</td><td>20</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Dense forest, rugged hills</td><td>1.5</td><td>15</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Swamp, marsh</td><td>1</td><td>10</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Mountains, dire wastelands</td><td>0.5</td><td>5</td></tr>
                            </tbody>
                        </table>
                        <p class="small text-body-secondary mb-0">
                            <strong>Road:</strong> ×2 speed (max 3 mph) &nbsp;&bull;&nbsp;
                            <strong>Foul weather/mud:</strong> ×0.5 &nbsp;&bull;&nbsp;
                            <strong>Deep snow:</strong> ×0.1
                        </p>
                    </div>

                    <div class="action-item">
                        <h5>Hours per 6-mile Hex</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Terrain</th><th>Hours</th></tr>
                            </thead>
                            <tbody>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Plains, savannas</td><td>2 h</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Light forest, desert</td><td>3 h</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Dense forest, rugged hills</td><td>4 h</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Swamp, marsh</td><td>6 h</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Mountains, dire wastelands</td><td>12 h</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="action-item">
                        <h5>Hex Exploration</h5>
                        <p>Scouting a 6-mile hex for points of interest takes <strong>1 full day</strong>. Rugged or concealing terrain (mountains, trackless swamp) doubles or triples this time.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sea Travel -->
        <div class="col-12 col-lg-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">Sea Travel</h5>
                </div>
                <div class="card-body">
                    <div class="action-item">
                        <h5>Speed</h5>
                        <p><strong>~6 mph</strong> under sail or oar.</p>
                    </div>

                    <div class="action-item">
                        <h5>Sailing</h5>
                        <p>Can sail <strong>around the clock</strong> when far from coasts — roughly <strong>144 miles/day</strong>.</p>
                    </div>

                    <div class="action-item">
                        <h5>Oar-Powered</h5>
                        <p>Heedless of wind, but an ordinary crew can only row <strong>8 hours/day</strong> — roughly <strong>48 miles/day</strong>.</p>
                    </div>

                    <div class="action-item">
                        <h5>Encounter Checks</h5>
                        <p>Roll <strong>daily and nightly</strong> on
                            <span class="dice" x-data="rollable" data-notation="1d10" @click="roll()" :class="{ 'rolled': rolled }" title="Click to roll" x-text="displayText">1d10</span>
                            or
                            <span class="dice" x-data="rollable" data-notation="1d12" @click="roll()" :class="{ 'rolled': rolled }" title="Click to roll" x-text="displayText">1d12</span>.
                            On a <strong>1</strong>: creature, storm, damage, crew trouble, or other complication.
                        </p>
                        <p class="small text-body-secondary mb-0">Some encounters yield to a good plan and <strong>Sail</strong> check; others require a fight.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Wilderness Encounters -->
        <div class="col-12 col-lg-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">Wandering Encounters</h5>
                </div>
                <div class="card-body">
                    <div class="action-item">
                        <h5>When to Roll</h5>
                        <ul class="small ps-3 mb-0">
                            <li>Once per <strong>day of travel</strong></li>
                            <li>Once per <strong>night camping outdoors</strong></li>
                            <li>Once per <strong>foraging attempt</strong></li>
                        </ul>
                        <p class="small text-body-secondary mt-1 mb-0">On a <strong>1</strong>, something requires the party's attention.</p>
                    </div>

                    <div class="action-item">
                        <h5>Encounter Chance by Terrain</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Die</th><th>Terrain</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="dice" x-data="rollable" data-notation="1d6" @click="roll()" :class="{ 'rolled': rolled }" title="Click to roll" x-text="displayText">1d6</span></td>
                                    <td>Dangerous wilderness</td>
                                </tr>
                                <tr>
                                    <td><span class="dice" x-data="rollable" data-notation="1d6" @click="roll()" :class="{ 'rolled': rolled }" title="Click to roll" x-text="displayText">1d6</span></td>
                                    <td>Civil unrest or heavy banditry</td>
                                </tr>
                                <tr>
                                    <td><span class="dice" x-data="rollable" data-notation="1d8" @click="roll()" :class="{ 'rolled': rolled }" title="Click to roll" x-text="displayText">1d8</span></td>
                                    <td>Borderlands or rural back country</td>
                                </tr>
                                <tr>
                                    <td><span class="dice" x-data="rollable" data-notation="1d8" @click="roll()" :class="{ 'rolled': rolled }" title="Click to roll" x-text="displayText">1d8</span></td>
                                    <td>Ordinary wilderness</td>
                                </tr>
                                <tr>
                                    <td><span class="dice" x-data="rollable" data-notation="1d8" @click="roll()" :class="{ 'rolled': rolled }" title="Click to roll" x-text="displayText">1d8</span></td>
                                    <td>Ordinary trade road</td>
                                </tr>
                                <tr>
                                    <td><span class="dice" x-data="rollable" data-notation="1d10" @click="roll()" :class="{ 'rolled': rolled }" title="Click to roll" x-text="displayText">1d10</span></td>
                                    <td>Well-policed trade road</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="action-item">
                        <h5>Encounter Distance</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Terrain</th><th>Distance</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="width: auto;">Open terrain</td>
                                    <td>max sight range</td>
                                </tr>
                                <tr>
                                    <td style="width: auto;">Forest, Hills</td>
                                    <td><span class="dice" x-data="rollable" data-notation="2d6" @click="roll()" :class="{ 'rolled': rolled }" title="Click to roll" x-text="displayText">2d6</span> &times; 10'</td>
                                </tr>
                                <tr>
                                    <td style="width: auto;">Obscured area</td>
                                    <td>shorter</td>
                                </tr>
                            </tbody>
                        </table>
                        <p class="small text-body-secondary mb-0">
                            <strong>Detection:</strong> Opposed <strong>Wis/Notice</strong> &mdash; winner can usually avoid if sufficient cover.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Foraging & Supplies -->
        <div class="col-12 col-lg-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">Foraging &amp; Supplies</h5>
                </div>
                <div class="card-body">

                    <div class="action-item">
                        <h5>1. Choose Duration</h5>
                        <p class="small text-body-secondary mb-0"><strong>Half-day</strong> or <strong>full day</strong> of effort (full day makes foraging easier — see step 2).</p>
                    </div>

                    <div class="action-item">
                        <h5>2. Roll Wis/Survive vs DC</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Base DC</th><th>Terrain</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>8</td><td>Woodlands, heavy vegetation</td></tr>
                                <tr><td>9</td><td>Mountains, scrublands, savannas</td></tr>
                                <tr><td>12</td><td>Deserts, badlands, normal barrens</td></tr>
                                <tr><td>14</td><td>Grim wastes, barely survivable lands</td></tr>
                            </tbody>
                        </table>
                        <div class="modifier-table mt-1">
                            <div class="mod-table-row">
                                <span class="mod-table-desc">Full day instead of half-day</span>
                                <span class="mod-table-value modifier-positive">&minus;2 DC</span>
                            </div>
                            <div class="mod-table-row">
                                <span class="mod-table-desc">Each extra day in same hex</span>
                                <span class="mod-table-value modifier-negative">+1 DC</span>
                            </div>
                        </div>
                    </div>

                    <div class="action-item">
                        <h5>3. On Success: Count Units Found</h5>
                        <div class="formula-box">
                            <span class="dice" x-data="rollable" data-notation="1d6" @click="roll()" :class="{ 'rolled': rolled }" title="Click to roll" x-text="displayText">1d6</span> + sum of group's Survive levels &le; 10
                        </div>
                        <p class="small text-body-secondary mt-1 mb-1">Each group member's Survive skill level is added. Members with <em>no</em> Survive skill reduce the total by 1 each (min 1 unit total). Barbarians/wilderness natives: always at least 2.</p>
                    </div>

                    <div class="action-item">
                        <h5>4. Assign Units</h5>
                        <p class="small text-body-secondary mb-1">After the roll, the group chooses how to split units:</p>
                        <div class="modifier-table">
                            <div class="mod-table-row">
                                <span class="mod-table-desc">1 day's food / person</span>
                                <span class="mod-table-value">1 enc</span>
                            </div>
                            <div class="mod-table-row">
                                <span class="mod-table-desc">1 day's water / person</span>
                                <span class="mod-table-value">1 enc</span>
                            </div>
                            <div class="mod-table-row">
                                <span class="mod-table-desc">1 night's firewood</span>
                                <span class="mod-table-value">4 enc</span>
                            </div>
                        </div>
                        <p class="small text-body-secondary mt-1 mb-0">Foraged food spoils in <strong>3 days</strong>. Preservation: half-day work + one unit of firewood.</p>
                    </div>

                </div>
            </div>
        </div>

        <!-- Privation -->
        <div class="col-12 col-lg-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">Privation</h5>
                </div>
                <div class="card-body">
                    <div class="action-item">
                        <h5>System Strain from Privation</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Condition</th><th>Strain</th></tr>
                            </thead>
                            <tbody>
                                <tr><td style="width: auto;">Night w/o shelter or fire</td><td>+0*</td></tr>
                                <tr><td style="width: auto;">1st day w/o food</td><td>+0*</td></tr>
                                <tr><td style="width: auto; color: #fd7e14;">1st day w/o water</td><td style="color: #fd7e14;">+2</td></tr>
                                <tr><td style="width: auto;">Harsh night w/o shelter</td><td>+1</td></tr>
                                <tr><td style="width: auto;">Consecutive day w/o food</td><td>+1</td></tr>
                                <tr><td style="width: auto; color: var(--bs-danger);">Consecutive day w/o water</td><td style="color: var(--bs-danger);">+3</td></tr>
                            </tbody>
                        </table>
                        <p class="small text-body-secondary mb-0">* No Strain yet, but PC can't recover lost resources.</p>
                    </div>

                    <div class="action-item">
                        <h5>System Strain</h5>
                        <p>Max System Strain = <strong>Con score</strong>. If Strain would exceed max, <strong>Physical save or die by dawn</strong>. On success: helpless until rescued.</p>
                    </div>

                    <div class="action-item">
                        <h5>Recovery (after proper rest)</h5>
                        <p class="small mb-1">Requires food + water + shelter + sleep:</p>
                        <ul class="small ps-3 mb-0">
                            <li>Regain <strong>level</strong> in HP</li>
                            <li>Regain all spell slots &amp; Effort</li>
                            <li>Lose <strong>1</strong> System Strain</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Beasts of Burden -->
        <div class="col-12 col-lg-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">Beasts of Burden</h5>
                </div>
                <div class="card-body">
                    <div class="action-item">
                        <p>In <strong>non-arid, non-barren terrain</strong>, beasts survive on nightly browse — no need to pack fodder or water.</p>
                    </div>

                    <div class="action-item">
                        <h5>Daily Needs (Arid Terrain)</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Beast</th><th>Fodder</th><th>Water</th></tr>
                            </thead>
                            <tbody>
                                <tr><td style="width: auto;">Mule / small beast</td><td>2 enc</td><td>4 enc</td></tr>
                                <tr><td style="width: auto;">Horse / large beast</td><td>4 enc</td><td>8 enc</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="action-item">
                        <h5>Carrying Capacity</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Beast / Porter</th><th>Enc</th></tr>
                            </thead>
                            <tbody>
                                <tr><td style="width: auto;">Riding/war horse, with laden rider</td><td>5</td></tr>
                                <tr><td style="width: auto;">Riding/war horse, pack only</td><td>20</td></tr>
                                <tr><td style="width: auto;">Heavy pack horse</td><td>30</td></tr>
                                <tr><td style="width: auto;">Mule or donkey</td><td>15</td></tr>
                                <tr><td style="width: auto;">Professional porter</td><td>12</td></tr>
                                <tr><td style="width: auto;">2 porters, shared litter</td><td>30</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="action-item">
                        <h5>Butchering</h5>
                        <p class="small mb-0">A healthy horse → <strong>30 days of rations</strong>. A mule or similar beast → <strong>15 days</strong>. Preserving requires time and fire.</p>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Alpine.js Components (uses $store.dice from base.html) -->
<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('rollable', () => ({
            notation: '',
            displayText: '',
            rolled: false,
            timeout: null,
            clickHandler: null,

            init() {
                this.notation = this.$el.dataset.notation || this.$el.textContent.trim();
                this.displayText = this.notation;
            },

            roll() {
                this.reset();
                const r = Alpine.store('dice').roll(this.notation);
                if (r) {
                    this.displayText = `${r.total} [${r.rolls.join(',')}]`;
                    this.rolled = true;

                    this.timeout = setTimeout(() => this.reset(), 3000);

                    this.clickHandler = (e) => {
                        if (e.target !== this.$el) this.reset();
                    };
                    setTimeout(() => document.addEventListener('click', this.clickHandler, { once: true }), 10);
                }
            },

            reset() {
                if (this.timeout) clearTimeout(this.timeout);
                if (this.clickHandler) document.removeEventListener('click', this.clickHandler);
                this.displayText = this.notation;
                this.rolled = false;
                this.timeout = null;
                this.clickHandler = null;
            }
        }));
    });
</script>
{% endblock %}
