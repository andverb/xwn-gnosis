{% extends "tools/wwn/cheatsheets/cheatsheet_base.html" %}

{% block title %}Подорожі та Виживання - Гнозис{% endblock %}

{% block cheatsheet_styles %}
<style>
    .compact-table {
        width: 100%;
        font-size: 0.85rem;
        margin: 0.5rem 0;
    }
    .compact-table th {
        font-weight: 600;
        color: var(--bs-secondary-color);
        font-size: 0.75rem;
        text-transform: uppercase;
    }
    .compact-table td:first-child {
        font-weight: bold;
        color: var(--bs-primary);
        width: 3rem;
        text-align: center;
    }
    .compact-table td:last-child {
        color: var(--bs-secondary-color);
    }

    .formula-box {
        font-family: monospace;
        font-size: 1rem;
        text-align: center;
        padding: 0.75rem;
    }
</style>
{% endblock %}

{% block cheatsheet_content %}
<div class="container">
    <div class="text-center mb-4">
        <h1 class="h2">Подорожі та Виживання</h1>
    </div>

    <div class="row g-3">

        <!-- Подорож по Землі -->
        <div class="col-12 col-lg-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">Подорож по Землі</h5>
                </div>
                <div class="card-body">
                    <div class="action-item">
                        <h5>Темп Подорожі</h5>
                        <p>Персонажі подорожують <strong>10 годин на день</strong>. Коні не підвищують середній темп.</p>
                    </div>

                    <div class="action-item">
                        <h5>Швидкість по Місцевості</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Місцевість</th><th>миль/год</th><th>миль/день</th></tr>
                            </thead>
                            <tbody>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Рівнини, савани</td><td>3</td><td>30</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Легкий ліс, пустеля</td><td>2</td><td>20</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Густий ліс, пересічена місцевість</td><td>1.5</td><td>15</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Болото</td><td>1</td><td>10</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Гори, смертоносні пустоші</td><td>0.5</td><td>5</td></tr>
                            </tbody>
                        </table>
                        <p class="small text-body-secondary mb-0">
                            <strong>Дорога:</strong> ×2 швидкість (макс 3 миль/год) &nbsp;&bull;&nbsp;
                            <strong>Погода/бруд:</strong> ×0.5 &nbsp;&bull;&nbsp;
                            <strong>Глибокий сніг:</strong> ×0.1
                        </p>
                    </div>

                    <div class="action-item">
                        <h5>Години на 6-мильний Гекс</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Місцевість</th><th>Години</th></tr>
                            </thead>
                            <tbody>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Рівнини, савани</td><td>2 год</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Легкий ліс, пустеля</td><td>3 год</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Густий ліс, пересічена місцевість</td><td>4 год</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Болото</td><td>6 год</td></tr>
                                <tr><td style="width:auto; font-weight:bold; color:var(--bs-primary);">Гори, смертоносні пустоші</td><td>12 год</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="action-item">
                        <h5>Дослідження Гексу</h5>
                        <p>Пошук цікавих місць у 6-мильному гексі займає <strong>1 повний день</strong>. Складна місцевість (гори, непрохідне болото) подвоює або потроює цей час.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Морська Подорож -->
        <div class="col-12 col-lg-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">Морська Подорож</h5>
                </div>
                <div class="card-body">
                    <div class="action-item">
                        <h5>Швидкість</h5>
                        <p><strong>~6 миль/год</strong> під вітрилами або на веслах.</p>
                    </div>

                    <div class="action-item">
                        <h5>Під Вітрилами</h5>
                        <p>Можна плисти <strong>цілодобово</strong> далеко від берегів — приблизно <strong>144 милі/день</strong>.</p>
                    </div>

                    <div class="action-item">
                        <h5>На Веслах</h5>
                        <p>Не залежить від вітру, але звичайна команда може веслувати лише <strong>8 годин/день</strong> — приблизно <strong>48 миль/день</strong>.</p>
                    </div>

                    <div class="action-item">
                        <h5>Перевірки Зустрічей</h5>
                        <p>Кидок <strong>щодня та щоночі</strong> на
                            <span class="dice" x-data="rollable" data-notation="1d10" @click="roll()" :class="{ 'rolled': rolled }" title="Натисніть для кидка" x-text="displayText">1d10</span>
                            або
                            <span class="dice" x-data="rollable" data-notation="1d12" @click="roll()" :class="{ 'rolled': rolled }" title="Натисніть для кидка" x-text="displayText">1d12</span>.
                            На <strong>1</strong>: істота, шторм, пошкодження, проблеми екіпажу тощо.
                        </p>
                        <p class="small text-body-secondary mb-0">Деякі зустрічі можна вирішити планом і перевіркою <strong>НАВІГАЦІЯ</strong>; інші — лише боєм.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Блукаючі Зустрічі -->
        <div class="col-12 col-lg-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">Блукаючі Зустрічі</h5>
                </div>
                <div class="card-body">
                    <div class="action-item">
                        <h5>Коли Кидати</h5>
                        <ul class="small ps-3 mb-0">
                            <li>Раз на <strong>день подорожі</strong></li>
                            <li>Раз на <strong>ніч у таборі</strong></li>
                            <li>Раз на <strong>спробу збору припасів</strong></li>
                        </ul>
                        <p class="small text-body-secondary mt-1 mb-0">На <strong>1</strong> — щось вимагає уваги групи.</p>
                    </div>

                    <div class="action-item">
                        <h5>Шанс Зустрічі за Місцевістю</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Кубик</th><th>Місцевість</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="dice" x-data="rollable" data-notation="1d6" @click="roll()" :class="{ 'rolled': rolled }" title="Натисніть для кидка" x-text="displayText">1d6</span></td>
                                    <td>Небезпечна дика місцевість</td>
                                </tr>
                                <tr>
                                    <td><span class="dice" x-data="rollable" data-notation="1d6" @click="roll()" :class="{ 'rolled': rolled }" title="Натисніть для кидка" x-text="displayText">1d6</span></td>
                                    <td>Громадські заворушення або бандитизм</td>
                                </tr>
                                <tr>
                                    <td><span class="dice" x-data="rollable" data-notation="1d8" @click="roll()" :class="{ 'rolled': rolled }" title="Натисніть для кидка" x-text="displayText">1d8</span></td>
                                    <td>Прикордоння або глухі землі</td>
                                </tr>
                                <tr>
                                    <td><span class="dice" x-data="rollable" data-notation="1d8" @click="roll()" :class="{ 'rolled': rolled }" title="Натисніть для кидка" x-text="displayText">1d8</span></td>
                                    <td>Звичайна дика місцевість</td>
                                </tr>
                                <tr>
                                    <td><span class="dice" x-data="rollable" data-notation="1d8" @click="roll()" :class="{ 'rolled': rolled }" title="Натисніть для кидка" x-text="displayText">1d8</span></td>
                                    <td>Звичайний торговий шлях</td>
                                </tr>
                                <tr>
                                    <td><span class="dice" x-data="rollable" data-notation="1d10" @click="roll()" :class="{ 'rolled': rolled }" title="Натисніть для кидка" x-text="displayText">1d10</span></td>
                                    <td>Добре охоронюваний тракт</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="action-item">
                        <h5>Дистанція Зустрічі</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Місцевість</th><th>Дистанція</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="width: auto;">Відкрита місцевість</td>
                                    <td>макс. видимість</td>
                                </tr>
                                <tr>
                                    <td style="width: auto;">Ліс, пагорби</td>
                                    <td><span class="dice" x-data="rollable" data-notation="2d6" @click="roll()" :class="{ 'rolled': rolled }" title="Натисніть для кидка" x-text="displayText">2d6</span> &times; 10'</td>
                                </tr>
                                <tr>
                                    <td style="width: auto;">Закрита місцевість</td>
                                    <td>менше</td>
                                </tr>
                            </tbody>
                        </table>
                        <p class="small text-body-secondary mb-0">
                            <strong>Виявлення:</strong> Протиставлена <strong>МУД/УВАГА</strong> &mdash; переможець зазвичай може уникнути зустрічі при достатньому укритті.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Збір Припасів -->
        <div class="col-12 col-lg-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">Збір Припасів</h5>
                </div>
                <div class="card-body">

                    <div class="action-item">
                        <h5>1. Обери Тривалість</h5>
                        <p class="small text-body-secondary mb-0"><strong>Пів дня</strong> або <strong>цілий день</strong> зусиль (цілий день знижує КС — дивись крок 2).</p>
                    </div>

                    <div class="action-item">
                        <h5>2. Кидок МУД/ВИЖИВАННЯ vs КС</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Базовий КС</th><th>Місцевість</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>8</td><td>Ліс, густа рослинність</td></tr>
                                <tr><td>9</td><td>Гори, чагарники, савани</td></tr>
                                <tr><td>12</td><td>Пустелі, безплідні землі</td></tr>
                                <tr><td>14</td><td>Смертоносні пустоші</td></tr>
                            </tbody>
                        </table>
                        <div class="modifier-table mt-1">
                            <div class="mod-table-row">
                                <span class="mod-table-desc">Цілий день замість пів дня</span>
                                <span class="mod-table-value modifier-positive">&minus;2 КС</span>
                            </div>
                            <div class="mod-table-row">
                                <span class="mod-table-desc">Кожен наступний день у тому ж гексі</span>
                                <span class="mod-table-value modifier-negative">+1 КС</span>
                            </div>
                        </div>
                    </div>

                    <div class="action-item">
                        <h5>3. Успіх: Підрахунок Одиниць</h5>
                        <div class="formula-box">
                            <span class="dice" x-data="rollable" data-notation="1d6" @click="roll()" :class="{ 'rolled': rolled }" title="Натисніть для кидка" x-text="displayText">1d6</span> + сума ВИЖИВАННЯ групи &le; 10
                        </div>
                        <p class="small text-body-secondary mt-1 mb-1">Додаються рівні навички ВИЖИВАННЯ кожного учасника. Члени групи <em>без</em> навички знижують підсумок на 1 (мін 1 одиниця). Варвари/уродженці дикої місцевості: завжди мінімум 2.</p>
                    </div>

                    <div class="action-item">
                        <h5>4. Розподіл Одиниць</h5>
                        <p class="small text-body-secondary mb-1">Після кидка група вирішує, як розподілити одиниці:</p>
                        <div class="modifier-table">
                            <div class="mod-table-row">
                                <span class="mod-table-desc">Денний запас їжі / особу</span>
                                <span class="mod-table-value">1Ж</span>
                            </div>
                            <div class="mod-table-row">
                                <span class="mod-table-desc">Денний запас води / особу</span>
                                <span class="mod-table-value">1Ж</span>
                            </div>
                            <div class="mod-table-row">
                                <span class="mod-table-desc">Нічний запас дров</span>
                                <span class="mod-table-value">4Ж</span>
                            </div>
                        </div>
                        <p class="small text-body-secondary mt-1 mb-0">Зібрана їжа псується через <strong>3 дні</strong>. Консервація: пів дня роботи + одна одиниця дров.</p>
                    </div>

                </div>
            </div>
        </div>

        <!-- Нестатки -->
        <div class="col-12 col-lg-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">Нестатки</h5>
                </div>
                <div class="card-body">
                    <div class="action-item">
                        <h5>Виснаження від Нестатків</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Умова</th><th>Виснаж.</th></tr>
                            </thead>
                            <tbody>
                                <tr><td style="width: auto;">Ніч без укриття або вогню</td><td>+0*</td></tr>
                                <tr><td style="width: auto;">1-й день без їжі</td><td>+0*</td></tr>
                                <tr><td style="width: auto; color: #fd7e14;">1-й день без води</td><td style="color: #fd7e14;">+2</td></tr>
                                <tr><td style="width: auto;">Сувора ніч без укриття</td><td>+1</td></tr>
                                <tr><td style="width: auto;">Наступний день без їжі</td><td>+1</td></tr>
                                <tr><td style="width: auto; color: var(--bs-danger);">Наступний день без води</td><td style="color: var(--bs-danger);">+3</td></tr>
                            </tbody>
                        </table>
                        <p class="small text-body-secondary mb-0">* Виснаження не зростає, але ПГ не може відновити витрачені ресурси.</p>
                    </div>

                    <div class="action-item">
                        <h5>Виснаження</h5>
                        <p>Максимум Виснаження = показник <strong>СТА</strong>. Якщо Виснаження перевищить максимум — <strong>Фізичний рятунок або смерть на світанку</strong>. Успіх: безпорадний до порятунку.</p>
                    </div>

                    <div class="action-item">
                        <h5>Відновлення (після повноцінного відпочинку)</h5>
                        <p class="small mb-1">Потрібні їжа + вода + укриття + сон:</p>
                        <ul class="small ps-3 mb-0">
                            <li>Відновлення ПЗ = <strong>рівень</strong></li>
                            <li>Відновлення всіх слотів заклять та Зусилля</li>
                            <li>Зниження Виснаження на <strong>1</strong></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- В'ючні Тварини -->
        <div class="col-12 col-lg-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">В'ючні Тварини</h5>
                </div>
                <div class="card-body">
                    <div class="action-item">
                        <p>На <strong>незасушливій, родючій місцевості</strong> тварини пасуться вночі — не потрібно пакувати корм чи воду.</p>
                    </div>

                    <div class="action-item">
                        <h5>Денні Потреби (Засушлива Місцевість)</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Тварина</th><th>Корм</th><th>Вода</th></tr>
                            </thead>
                            <tbody>
                                <tr><td style="width: auto;">Мул / мала тварина</td><td>2Ж</td><td>4Ж</td></tr>
                                <tr><td style="width: auto;">Кінь / велика тварина</td><td>4Ж</td><td>8Ж</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="action-item">
                        <h5>Вантажність</h5>
                        <table class="table table-sm compact-table">
                            <thead>
                                <tr><th>Тварина / Носильник</th><th>Ж</th></tr>
                            </thead>
                            <tbody>
                                <tr><td style="width: auto;">Верховий/бойовий кінь, з вершником</td><td>5</td></tr>
                                <tr><td style="width: auto;">Верховий/бойовий кінь, без вершника</td><td>20</td></tr>
                                <tr><td style="width: auto;">Важкий в'ючний кінь</td><td>30</td></tr>
                                <tr><td style="width: auto;">Мул або осел</td><td>15</td></tr>
                                <tr><td style="width: auto;">Найманий носильник</td><td>12</td></tr>
                                <tr><td style="width: auto;">2 носильники зі спільними ношами</td><td>30</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="action-item">
                        <h5>Забій</h5>
                        <p class="small mb-0">Здоровий кінь → <strong>30 днів їжі</strong>. Мул або подібна тварина → <strong>15 днів</strong>. Консервація потребує часу та вогню.</p>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Alpine.js Components (uses $store.dice from base.html) -->
<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('rollable', () => ({
            notation: '',
            displayText: '',
            rolled: false,
            timeout: null,
            clickHandler: null,

            init() {
                this.notation = this.$el.dataset.notation || this.$el.textContent.trim();
                this.displayText = this.notation;
            },

            roll() {
                this.reset();
                const r = Alpine.store('dice').roll(this.notation);
                if (r) {
                    this.displayText = `${r.total} [${r.rolls.join(',')}]`;
                    this.rolled = true;

                    this.timeout = setTimeout(() => this.reset(), 3000);

                    this.clickHandler = (e) => {
                        if (e.target !== this.$el) this.reset();
                    };
                    setTimeout(() => document.addEventListener('click', this.clickHandler, { once: true }), 10);
                }
            },

            reset() {
                if (this.timeout) clearTimeout(this.timeout);
                if (this.clickHandler) document.removeEventListener('click', this.clickHandler);
                this.displayText = this.notation;
                this.rolled = false;
                this.timeout = null;
                this.clickHandler = null;
            }
        }));
    });
</script>
{% endblock %}
